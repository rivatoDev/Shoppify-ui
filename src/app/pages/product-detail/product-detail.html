@if (product) {
  <div class="product-detail-container">
    <div class="product-detail">

      <div class="product-image-section">
        <div class="main-image-container">
          <img
            [src]="product.imgURL || 'public/image/genericProduct.png'"
            [alt]="product.name"
            class="main-product-image">
        </div>
      </div>

      <div class="product-info-section">
        <div class="product-badge">
          @if (product.soldQuantity > 0) {
            <span class="badge-new">Nuevo</span>
            <span class="sold-badge">+{{ product.soldQuantity }} vendidos</span>
          }
        </div>

        <h1 class="product-title">{{ product.name }}</h1>

        @if (product.brand) {
          <div class="product-brand">
            <span class="brand-label">Marca:</span>
            <span class="brand-name">{{ product.brand }}</span>
          </div>
        }

        @if (product.description) {
          <div class="product-description">
            <h3>Descripcion</h3>
            <p>{{ product.description }}</p>
          </div>
        }

        @if (userId && cartQuantity > 0) {
          <div class="cart-quantity-note">
         
              Tienes {{ cartQuantity }} unidad{{ cartQuantity !== 1 ? 'es' : '' }} en tu carrito
            
            
          </div>
        }

  
      </div>

      <div class="product-purchase-section">
        @if (product.stock > 0) {
        <button
          type="button"
          class="favorite-icon-button"
          [class.is-active]="isFavorite"
          (click)="toggleFavorite()"
          [attr.aria-pressed]="isFavorite"
          [attr.aria-label]="isFavorite ? 'Quitar de favoritos' : 'Agregar a favoritos'">
          <svg class="favorite-heart" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.25 5.96a4.41 4.41 0 0 0-6.19 0L12 8.02l-2.06-2.06a4.41 4.41 0 0 0-6.19 0 4.44 4.44 0 0 0 0 6.25l2.06 2.06L12 21l6.19-6.69 2.06-2.06a4.44 4.44 0 0 0 0-6.25Z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        }
        @if (isHidden) {
        <div class="hidden-product-message">
          <span>Este producto no se encuentra disponible en este momento.</span>
        </div>
        }@else {
        <div class="price-container">
          @if (product.discountPercentage > 0) {
            <span class="price-original">{{ product.price | currency:'ARS':'symbol':'1.0-2' }}</span>
            <div class="price-row">
              <span class="product-price">{{ product.priceWithDiscount | currency:'ARS':'symbol':'1.0-2' }}</span>
              <span class="discount-badge">-{{ product.discountPercentage | number:'1.0-2' }}%</span>
            </div>
            @if (product.priceWithDiscount) {
            <span class="price-savings">Ahorras {{ (product.price - product.priceWithDiscount) | currency:'ARS':'symbol':'1.0-2' }}</span>
            }
           
          }
          @else {
            <span class="product-price">{{ product.price | currency:'ARS':'symbol':'1.0-2' }}</span>
          }

         
          @if (product.priceWithDiscount! > 1000) {
            <span class="installment">
              6 cuotas de {{ (product.priceWithDiscount! / 6) | currency:'ARS':'symbol':'1.0-2' }}
            </span>
          }
        </div>
        @if (product.stock > 1) {
          <div class="stock-status ok">
            Stock disponible ({{ product.stock }} unidades)
          </div>
        } @else {
          <div class="stock-status empty">
            Este producto se encuentra sin stock.
          </div>
        }
            
        
         
         
     

        @if (maxAvailable > 0) {
                  <div class="quantity-selector">
          <button class="quantity-trigger" type="button" (click)="toggleQuantityDropdown()">
            <span class="qty-label">Cantidad:</span>
            <span class="qty-value">{{ selectedQuantity }} unidad{{ selectedQuantity > 1 ? 'es' : '' }}</span>
            <span class="chevron" [class.open]="isQuantityOpen">&#9656;</span>
            <span class="qty-stock">{{maxAvailable }} disponibles</span>
          </button>

        
          @if (isQuantityOpen) {
            <div class="quantity-menu">
              @for (opt of dropdownOptions; track opt) {
                <button type="button" class="quantity-option" (click)="selectQuantity(opt)">
                  {{ opt }} unidad{{ opt > 1 ? 'es' : '' }}
                </button>
              }
              
             
            @if (maxAvailable > 4) {
               <div class="menu-divider"></div>
  <button type="button" class="quantity-option custom" (click)="selectCustomQuantity()">
                Mas de {{ dropdownOptions.length ? dropdownOptions[dropdownOptions.length - 1] : 6 }} unidades
              </button>
              }
            </div>
          }
        </div>
        }



        <div class="actions">

          @if (product.stock > 1) {
          <button class="btn btn-buy" (click)="onBuyNow()">
            <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            Comprar ahora
          </button>
            }
            @else {
           <button class="btn btn-buy" (click)="toggleFavorite()">

           {{isFavorite ? 'Dejar de notificarme' : 'Notificarme cuando est√© disponible'}}
                       <i class="material-icons">{{isFavorite ? 'notifications_off' : 'notifications'}}</i>
          </button>
        }
          @if (product.stock > 1) {
          <button class="btn btn-cart" (click)="onAddToCart()">
            <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 9v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9"></path>
              <path d="M9 22V12h6v10"></path>
              <path d="M1 10.6L12 2l11 8.6"></path>
            </svg>
            Agregar al carrito
         
          </button>
        }
        </div>
      }
      </div>

    </div>

    <!-- Related Products Section -->
    @if (relatedProducts.length > 0) {
      <div class="related-products-strip">
        <div class="related-header">
          <div>
            <h2 class="related-title">Productos relacionados</h2>
          </div>
        </div>
        <div class="related-grid">
          @for (relatedProduct of relatedProducts; track relatedProduct.id) {
            <app-product-card
              [product]="relatedProduct"
              [isMostrarCuotas]="true"
              [isMostrarDescuento]="true"
              [isMostrarStock]="false"
              [isMostrarDescripcion]="false"></app-product-card>
          }
        </div>
      </div>
    }

  </div>
}
