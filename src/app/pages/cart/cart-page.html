<div class="cart-container">


  @if (items.length > 0) {
  <div class="cart-layout">
    <section class="items-panel">
      <div class="panel-header">
        <div class="panel-title">
          <input id="allCheckbox" type="checkbox" [checked]="allSelected" (change)="toggleAll()" />
          <div>
            <span>Productos</span>
          </div>
        </div>
      </div>

      <div class="cart-list">
        @for (item of items; track item.id) {
        <div class="cart-item">
          <label class="select-label">
            <input type="checkbox" [checked]="cService.selected().has(item.id!)"
              (change)="toggleSelection(item.id!, $any($event.target).checked)" />
          </label>

          <div class="item-body">
            <div class="item-media">
              <img [src]="item.product?.imgURL" [alt]="item.product?.name || 'Producto'"
                (click)="goToDetailProduct(item.product?.id)">
            </div>
            <div class="item-info">
              <div class="item-title">{{ item.product?.name }}</div>

              <div class="price-row">
                @if (item.product?.discountPercentage ) {
                <span class="price-original">{{ item.product?.price | currency:'ARS':'symbol':'1.0-2' }}</span>
                <span class="price-final">{{ item.product?.priceWithDiscount ?? item.product?.price | currency:'ARS':'symbol':'1.0-2' }}</span>
                <span class="discount-pill">-{{ item.product?.discountPercentage }}%</span>
                } @else {
                <span class="price-final">{{ item.product?.price | currency:'ARS':'symbol':'1.0-2' }}</span>
                }
              </div>

              @if (item.product) {
              <div class="installment">
                <button class="remove-btn" (click)="removeFromCart(item.id!)">Eliminar</button>
              </div>
              }
            </div>
          </div>

          <div class="cart-controls">
            <div class="quantity-control">
              <button type="button" [disabled]="item.quantity! == 1" (click)="changeQuantity(item, -1)">-</button>
              <input type="number" [value]="item.quantity" readonly />
              <button type="button" [disabled]="item.quantity! == item.product?.stock!"
                (click)="changeQuantity(item, 1)">+</button>
            </div>
            <span class="stock-note">{{ item.product?.stock}} disponibles</span>

          </div>

          <div class="item-subtotal">
            <strong>{{ item.subtotal | currency:'ARS':'symbol':'1.0-2' }}</strong>
          </div>
        </div>
        }
      </div>


    </section>

    <aside class="summary-card">
      <h3>Resumen de compra</h3>
      @for (item of items; track item.id) {
          @if (cService.selected().has(item.id!)) {
      <div class="summary-block">
        <div class="summary-row">
          <span>
            {{ item.product?.name }}
            {{ item.quantity! > 1 ? '(' + item.quantity + ')' : '' }}
          </span>
          <span>{{ item.subtotal | currency:'ARS':'symbol':'1.0-2' }}</span>
        </div>
      </div>
    }
    }

      <div class="summary-total">
        <span>Total</span>
        <span class="total-amount">{{ total | currency:'ARS':'symbol':'1.0-2' }}</span>
      </div>

      <button (click)="router.navigate(['/cart/shipping'])" [disabled]="cService.selected().size === 0" class="checkout-btn">
        Continuar compra
      </button>
    </aside>
  </div>
  } @else {
  <div class="empty-cart">
    <h3>Tu carrito esta vacio</h3>
    <p>Agrega algunos productos para comenzar.</p>
  </div>
  }
</div>
