<div class="purchases-container">
  <h2>Mis Compras</h2>

  @if(isAdmin){
  <div class="filters-toggle" (click)="toggleFilters()" (keyup.enter)="toggleFilters()" [class.open]="filtersOpen"
    role="button" tabindex="0">
    <span>Filtros de compras</span>
    <span class="chevron" [class.up]="filtersOpen">âŒ„</span>
  </div>

  <div class="filters" [class.is-open]="filtersOpen">
    <label>Desde: <input type="date" [(ngModel)]="filters.startDate"></label>
    <label>Hasta: <input type="date" [(ngModel)]="filters.endDate"></label>
    <label>Metodo de pago:
      <select [(ngModel)]="filters.paymentMethod">
        <option value="">Todos</option>
        <option value="CASH">Efectivo</option>
        <option value="CREDIT">Tarjeta</option>
        <option value="DEBIT">Debito</option>
        <option value="DIGITAL">Transferencia</option>
      </select>
    </label>
    <label>Minimo: <input type="number" [(ngModel)]="filters.minPrice"></label>
    <label>Maximo: <input type="number" [(ngModel)]="filters.maxPrice"></label>

    <div class="filters-actions">
      <button class="clear-filters" type="button" (click)="clearFilters()">Limpiar filtros</button>
      <button (click)="applyFilters()">Filtrar</button>
    </div>
  </div>
  }

  @if (isAdmin) {
  <button type="button" (click)="toggleAdminView()" class="admin-toggle" id="admin-toggle"
    [ngClass]="{ 'active': adminView }">
    Ver todas las compras
  </button>
  }

  @if (purchases().length > 5) {
  <label>Mostrar:
    <select [(ngModel)]="purchasesXPage" (change)="loadTransactions()">
      <option [value]="5">5</option>
      <option [value]="10">10</option>
      <option [value]="25">25</option>
      <option [value]="50">50</option>
    </select>
    por pagina
  </label>
  }

  @if (purchases().length > 0) {
  @if (totalPages > 1) {
  <div class="pagination">
    <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 0">Anterior</button>
    <span>Pagina {{ currentPage + 1 }} de {{ totalPages }}</span>
    <button (click)="changePage(currentPage + 1)" [disabled]="currentPage >= totalPages - 1">Siguiente</button>
  </div>
  }
  <div class="purchases-list">
    @for (purchase of purchases(); let i = $index; track purchase.id) {
      <app-purchase-card
        [purchase]="purchase"
        [i]="i"
        [isAdmin]="isAdmin"
        [showShipment]="true"
        [showRebuy]="!isAdmin"
        [showTotal]="isAdmin"
        [showDate]="isAdmin"
      ></app-purchase-card>
    }
  </div>

  } @else if(filters.startDate || filters.endDate || filters.paymentMethod || filters.minPrice || filters.maxPrice) {
  <div class="no-results">
    <p>No se encontraron compras que coincidan con los filtros aplicados</p>
  </div>
  } @else{
  <div class="empty-purchases">
    <p>No tenes compras registradas</p>
  </div>
  }
</div>