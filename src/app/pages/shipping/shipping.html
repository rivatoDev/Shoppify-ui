<div class="shipping-container">
    <app-back-button></app-back-button>
    <div class="shipping-header">
        <h2>¬øC√≥mo quieres recibir tu compra?</h2>
        <p>Elige tu opci√≥n de preferencia</p>
    </div>

    <div class="options-grid">
        <div class="option-card" [class.selected]="deliveryType() === 'delivery'"
            (click)="setDeliveryType('delivery')">
            <div class="radio-indicator"></div>
            <div class="option-content">
                <span class="icon">üöö</span>
                <div class="text">
                    <h3>Env√≠o a domicilio</h3>
                    <p>Recibe tu pedido en la puerta de tu casa</p>
                </div>
            </div>
        </div>

        <div class="option-card" [class.selected]="deliveryType() === 'pickup'"
            (click)="setDeliveryType('pickup')">
            <div class="radio-indicator"></div>
            <div class="option-content">
                <span class="icon">üè™</span>
                <div class="text">
                    <h3>Retiro en local</h3>
                    <p>Pasa a buscarlo por nuestra sucursal</p>
                </div>
            </div>
        </div>
    </div>

    <div class="details-section">
        @if (deliveryType() === 'delivery') {
        <form [formGroup]="shippingForm" class="shipping-form swing-in-top-fwd">
            <h3>Ingresa tu direcci√≥n</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Calle</label>
                    <input type="text" formControlName="street" placeholder="Ej: Av. Principal">
                    @if (shippingForm.get('street')?.touched) {
                        @if (shippingForm.get('street')?.hasError('required')) {
                            <span class="error-msg">Este campo es requerido</span>
                        }@else if (shippingForm.get('street')?.hasError('maxlength')) {
                            <span class="error-msg">No puede tener mas de 50 caracteres</span>
                        }
                    }
                </div>
                <div class="form-group small">
                    <label>N√∫mero</label>
                    <input type="number" formControlName="number" placeholder="1234">
                    @if (shippingForm.get('number')?.touched && shippingForm.get('number')?.invalid) {
                        <span class="error-msg">Requerido</span>
                    }
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Ciudad</label>
                    <input type="text" formControlName="city" placeholder="Tu ciudad">
                    @if (shippingForm.get('city')?.touched) {
                        @if (shippingForm.get('city')?.hasError('required')) {
                            <span class="error-msg">Requerido</span>
                        }@else if (shippingForm.get('city')?.hasError('maxlength')) {
                            <span class="error-msg">No puede tener mas de 50 caracteres</span>
                        }
                    }
                </div>
                <div class="form-group small">
                    <label>CP</label>
                    <input type="text" formControlName="zip" placeholder="CP">
                    @if (shippingForm.get('zip')?.touched) {
                        @if (shippingForm.get('zip')?.hasError('required')) {
                            <span class="error-msg">Requerido</span>
                        }@else if (shippingForm.get('zip')?.hasError('maxlength')) {
                            <span class="error-msg">No puede tener mas de 50 caracteres</span>
                        }
                    }
                </div>
            </div>

             <div class="form-group">
                <label>Indicaciones adicionales (opcional)</label>
                <textarea formControlName="notes" rows="2" placeholder="Ej: Dejar en porter√≠a"></textarea>
                <h6 [class.over-limit]="shippingForm.get('notes')?.value.length > 100">
                    {{shippingForm.get('notes')?.value.length}}/100
                </h6>

                @if(shippingForm.get('notes')?.touched && shippingForm.get('notes')?.invalid) {
                    <span class="error-msg">Debe tener menos de 100 caracteres</span>
                } 
            </div>
        </form>
        } @else {
        <div class="pickup-info swing-in-top-fwd">
            <div class="map-placeholder">
                üìç
            </div>
            <div class="store-details">
                <h3>Nuestra Sucursal</h3>
                <p class="address">{{ storeAddress() }}</p>
                <div class="info-badges">
                    <span class="badge">Gratis</span>
                </div>
                <p class="note">Te avisaremos cuando tu pedido est√© listo para retirar.</p>
            </div>
        </div>
        }
    </div>

    <div class="actions">
        <button class="continue-btn" (click)="onSubmit()">
            Continuar
            <span class="arrow">‚Üí</span>
        </button>
    </div>
</div>
